<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<title>预约详情</title>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui">
	<link rel="stylesheet" type="text/css" href="./css/pe.css">
	<script type="text/javascript" src="./js/us.js"></script>
	<script type="text/javascript" src="./js/jq.js"></script>
	<script type="text/javascript" src="./js/pe.js"></script>
	<script type="text/javascript">
		$(function(){
			var store = getInfo.checkstorage();
			if(!store || !store.name || !store.email){
				/*getInfo.turnprofilecreat();*/
			}else{
				//停留该页
				var order = getInfo.getOrderInfo();
				if(!order || !order.order) {getInfo.turnappointmentmine();}
				if(order.order.state=="已起息，但合同文本基金管理人未收讫"){
					getInfo.turnappointmentdetailstep2(order.order.id);
				}
				//order
				var base = $('#order-base');
				var info = order.order;
				base.find('li:eq(0) span').text(info.investor_name||"");
				base.find('li:eq(1) span').text(info.product_name||"");
				base.find('li:eq(2) span').text(info.currency||"人民币");
				base.find('li:eq(3) span').text(info.amount+"万");
				base.find('li:eq(4) span').text(info.due_date||"");
				$("#inputIdno").val(info.number);
				if(info.deliver=="未快递"){
					$("#inputSendState").val(info.deliver).attr('data-val',0);
					$("#inputSendState+select-ul li:eq(0)").addClass('current');
					addicon($("#inputSendState"),'icon-rwrong');
				}else if(info.deliver=="已快递"){
					$("#inputSendState").val(info.deliver).attr('data-val',1);
					$("#inputSendState+select-ul li:eq(1)").addClass('current');
					addicon($("#inputSendState"),'icon-gright');
				}
				$('#inputRemark').val(info.remark);
				if(info.remark){
					addicon($('#inputRemark'),'icon-gright');
				}else{
					addicon($('#inputRemark'),'icon-rwrong');
				}
				$("#editCustomerBtn").attr({'data-type':info.investable_type,'data-cid':info.investable_id,'data-back':"appointment-detail-step1"});
				$("#submitBtn[name=appointmentUpdate]").attr('data-oid',info.id)
				$("#deleteBtn[name=appointmentDelete]").attr('data-oid',info.id)
				//infos
				if(order.infos && order.infos.length>0){
					var infos= order.infos;
					for(var i=0;i<infos.length;i++){
						var type = infos[i].field_type.toLowerCase();
						var template = $("#" + type + "-template").clone();						
						template.find('.icon-ahead span').text(infos[i].field_name);
						template.find('.input-box input,.img-box input,.input-box textarea').attr({
							"data-category":infos[i].category,
							"data-field_type":type,
							"data-id":infos[i].id,
							"id":"info" + type +infos[i].id,
							"name":"info" + type,
							"placeholder":"请输入"+infos[i].field_name
						});
						if(type=="string"&&infos[i].string){
							template.find('.input-box input').val(infos[i].string);
						}else if(type=="text"&&infos[i].text){
							template.find('.input-box textarea').val(infos[i].text);
						}else if(type=="photo"&&infos[i].photo.photo.url){
							template.find('.img-box .img-default').append("<img />").find('img').attr('src',infos[i].photo.photo.url);
						}
						template.find('label').attr('for',"info" + type +infos[i].id);
						template.find('[role=alert]').attr("name","info" + type + infos[i].id);
						if(infos[i].state == "已确认"){
							template.find('.input-box input,.input-box textarea,.img-box input').attr("readonly",true).closest('span').addClass('nochange');
							template.find('.icon-ahead .icon').addClass("icon-gright");
						}else if(infos[i].state == "未确认"){
							template.find('.icon-ahead .icon').addClass("icon-rwrong");
						}
						$("#infoForm").append(template.find(".form-line"));
						$("#infoForm").append(template.find(".alert"));
						rebind();
					}
				}
				//money_receipts
				if(order.money_receipts && order.money_receipts.length>0){
					var money = order.money_receipts
					for(var i=0;i<money.length;i++){
						var template = $("#money-template").clone();
						template.find('input[type=number]').val(money[i].amount);
						template.find('input[type=date]').val(money[i].date);
						template.find('.img-default').append('<img />')
							.find('img').attr('src',money[i].attach.attach.url);
						if(money[i].state == "未确认"){
							template.find('.icon-ahead .icon').addClass("icon-rwrong");
						}else if(infos[i].state == "已确认"){
							template.find('.icon-ahead .icon').addClass("icon-gright");
						}
						$("#moneyForm").append(template.find(".form-line,.alert"));
					}
				}
				//删除按钮
				$('#showdelete').bind('click',function(){
					$('#popalert').removeClass('hide');
					pop.appear=setTimeout(function(){
                        $("#popalert .pop-alert").addClass('appear');
                    },100);
				});
				$('#popalert button').bind('click',function(){
					$("#popalert .pop-alert").removeClass('appear');
					pop.appear=setTimeout(function(){
						$('#popalert').addClass('hide');
					},400);
				});
			}
		});
		function rebind(){
			$("#infoForm input[type=file]").bind("blur",function(){
				check.img($(this));
	        });
	        $("#infoForm input[type=file]").bind("change",function(e){
	            if(check.img($(this))){
	                var input = $(this);
	                var f = input[0].files[0];
	                var label = input.prev();
	                var reader = new FileReader();
	                reader.onload=function(e){
	                    input.attr('data-code',reader.result);
	                    var img = $("<img />").attr('src',reader.result);
	                    label.empty().append(img);
	                }
	                if(f){
	                   reader.readAsDataURL(f); 
	                }
	            }
	        });
	        $('#infoForm textarea').bind("blur",function(){
	            check.text($(this));
	        });
	        $('#infoForm input[type=text]').bind("blur",function(){
	            check.string($(this));
	        });
		}
		function addicon(input,type){
			$(input).closest('.form-line').find('.icon-ahead .icon').addClass(type);
		}
	</script>
</head>
<body class="bg-white">
	<div class="main detail">
		<div class="appointment-detail-step1">
			<div class="title-line-grey">预约情况</div>
			<ul class="line-list nb" id="order-base">
				<li>
					<label>投资者名称</label>
					<span></span>
				</li>
				<li>
					<label>预约产品</label>
					<span></span>
				</li>
				<li>
					<label>币&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;种</label>
					<span></span>
				</li>
				<li>
					<label>预约金额</label>
					<span></span>
				</li>
				<li>
					<label>预约日期</label>
					<span></span>
				</li>
			</ul>
			<div class="title-line-grey">打款/签约情况<span class="small">（打勾代表已确认）</span></div>
			<form class="radius-form mt20" id="form">
				<div class="form-line">
					<label class="icon-ahead"><i class="icon icon-gright"></i>证件号码</label>
					<span class="input-box finished">
						<input type="text" class="spinput" id="inputIdno" readonly />
						<button class="word-btn blue" id="editCustomerBtn" data-turn="customer-detail">编辑</button>
					</span>
				</div>
				<div id="moneyForm">
				</div>
				<div class="form-line">
					<label class="icon-ahead" for="inputMoney"><i class="icon "></i>打款金额</label>
					<span class="input-box">
						<input type="text" class="sspinput" id="inputMoney" placeholder="请输入打款金额" />
						<i class="unit">万</i>
					</span>
				</div>
				<div class="alert" role="alert" name="inputMoney"></div>
				<div class="form-line">
					<label class="icon-ahead" for="inputDate"><i class="icon "></i>打款日期</label>
					<span class="input-box">
						<input type="date" id="inputDate" placeholder="请选择打款日期" />
					</span>
				</div>
				<div class="alert" role="alert" name="inputDate"></div>
				<div class="form-line">
					<label class="icon-ahead" for="inputImgSend"><i class="icon "></i>打款凭条</label>
					<span class="img-box">
						<label for="inputImgSend" class="img-default"></label>
						<input class="hide" type="file" id="inputImgSend" />
					</span>
				</div>
				<div class="alert" role="alert" name="inputImgSend"></div>
				<div id="infoForm">
				</div>
				<div class="form-line">
					<label class="icon-ahead dbl"><i class="icon"></i>合同快递<br/>至管理人</label>
					<span class="input-box selectinput">
						<input type="text" placeholder="已快递/未快递" readonly class="input-select" id="inputSendState" />
						<ul class="select-ul">
							<li data-val='0'>未快递</li>
							<li data-val='1'>已快递</li>
						</ul>
					</span>
				</div>
				<div class="alert" role="alert" name=""></div>
				<div class="form-line">
					<label class="icon-ahead"><i class="icon "></i>备注</label>
					<span class="input-box">
						<textarea id="inputRemark" placeholder="请填写备注"></textarea>
					</span>
				</div>
				<div class="alert" role="alert" name="inputRemark"></div>
				<div class="form-line">
					<label  class="icon-ahead">&nbsp;
					</label>
					<div class="rf-btns">
						<button class="submit-btn orange-btn" id="submitBtn" name="appointmentUpdate">提交</button>
						<button class="submit-btn red-btn"  id="showdelete">删除此订单</button>
					</div>
				</div>
			</form>
			<div class="bigtips hide">
				<p>后台正在复审资料，等待起息中...</p>
			</div>
		</div>
	</div>
	<div class="pop-bg hide" id="pop">
		<div class="pop-alert">
			<span class="pop-test"></span>
		</div>
	</div>
	<div class="pop-bg hide" id="popalert">
		<div class="pop-alert">
			<p class="big middle">请确认删除</p>
			<div class="pop-btns">
				<button class="half-btn" id="deleteBtn" name="appointmentDelete">确认</button>
				<button class="half-btn">取消</button>
			</div>
		</div>
	</div>
	<div id="template" class="hide">
		<div id="money-template">
			<div class="form-line">
				<label class="icon-ahead"><i class="icon "></i>打款金额</label>
				<span class="input-box nochange">
					<input type="text" class="sspinput" readonly />
					<i class="unit">万</i>
				</span>
			</div>
			<div class="alert" role="alert" name=""></div>
			<div class="form-line">
				<label class="icon-ahead"><i class="icon "></i>打款日期</label>
				<span class="input-box nochange">
					<input type="date" readonly />
				</span>
			</div>
			<div class="alert" role="alert" name=""></div>
			<div class="form-line">
				<label class="icon-ahead"><i class="icon "></i>打款凭条</label>
				<span class="img-box">
					<label class="img-default"></label>
					<input class="hide" type="file" readonly />
				</span>
			</div>
			<div class="alert" role="alert" name=""></div>
		</div>
		<div id="string-template">
			<div class="form-line">
				<label class="icon-ahead"><i class="icon"></i><span></span></label>
				<span class="input-box">
					<input type="text" />
				</span>
			</div>
			<div class="alert" role="alert"></div>
		</div>
		<div id="text-template">
			<div class="form-line">
				<label class="icon-ahead"><i class="icon"></i><span></span></label>
				<span class="input-box">
					<textarea></textarea>
				</span>
			</div>
			<div class="alert" role="alert"></div>
		</div>
		<div id="photo-template">
			<div class="form-line">
				<label class="icon-ahead"><i class="icon"></i><span></span></label>
				<span class="img-box">
					<label class="img-default"></label>
					<input class="hide" type="file"/>
				</span>
			</div>
			<div class="alert" role="alert"></div>
		</div>
	</div>
</body>
</html>